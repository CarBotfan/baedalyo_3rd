<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.beadalyo.jhw.user.UserMapper">
    <insert id="signUpUser" keyProperty="userPk" useGeneratedKeys="true">
        INSERT into user
        SET user_id = #{userId}
        , user_pw = #{userPw}
        , user_name = #{userName}
        , user_nickname = #{userNickname}
        , user_pic = #{userPic}
        , user_phone = #{userPhone}
        , user_role = #{userRole}
        , user_login_type = #{userLoginType}
    </insert>
    <select id="getUserById">
        SELECT
        user_pk AS userPk
        , user_id AS userId
        , user_pw AS userPw
        , user_name AS userName
        , user_pic AS userPic
        , user_state AS userState
        , user_role AS userRole
        FROM user
        WHERE user_id = #{userId}
    </select>
    <select id="getUserByPk">
        SELECT
        user_pk AS userPk
        , user_id AS userId
        , user_pw AS userPw
        , user_name AS userName
        , user_pic AS userPic
        , user_state AS userState
        , user_role AS userRole
        FROM user
        WHERE user_pk = #{userPk}
    </select>
    <select id="selProfileUserInfo">
        SELECT
        user_id AS userId
        , user_name AS userName
        , user_nickname AS userNickname
        , user_pic AS userPic
        , user_phone AS userPhone
        FROM user
        WHERE user_pk = #{signedUserPk}
    </select>
    <update id="updProfilePic">
        UPDATE user
        SET user_pic = #{picName}
        WHERE user_pk = #{signedUserPk}
    </update>
    <update id="updUserInfo">
        UPDATE user
        <set>
            <if test="userNickname != null and !userNickname.equals('')">
                user_nickname = #{userNickname}
            </if>
            <if test = "userPhone != null and !userPhone.equals('')">
                , user_phone = #{userPhone}
            </if>
        </set>
        WHERE user_pk = #{signedUserPk}
    </update>
    <update id="updUserPassword">
        UPDATE user
        SET user_pw = #{newPw}
        WHERE user_pk = #{signedUserPk}
    </update>
    <update id="deleteUser">
        UPDATE user
        SET user_state = 3
        WHERE user_pk = #{userPk}
    </update>
    <select id="getMainAddr">
        SELECT
        addr1 , addr2
        , addr_coor_x AS addrCoorX
        , addr_coor_y AS addrCoorY
        FROM address
        WHERE addr_user_pk = #{signedUserPk}
        AND addr_default = #{signedUserPk}
    </select>
</mapper>